<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sulaiman Al‑Shabebi | Mechatronics</title>
  <meta name="description" content="Bilingual portfolio with live Owner editor (no backend)." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b1020; --card: #121836; --muted: #8ea3c6; --text: #e6ecff;
      --acc: #6ea8ff; --acc2: #86efac; --danger: #ff6b6b; --ring: rgba(110,168,255,.35);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body { margin: 0; background: radial-gradient(1200px 600px at 10% -10%, #1b2455 0, transparent 60%),
      radial-gradient(1200px 600px at 110% 0%, #1b2455 0, transparent 60%), var(--bg);
      color: var(--text); font-family: Cairo, Inter, system-ui, Arial, sans-serif; }
    a{ color: var(--acc) }
    .container { max-width:1200px; margin:0 auto; padding:24px }
    .nav { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; flex-wrap:wrap }
    .tabs { display:flex; gap:6px; flex-wrap:wrap }
    .btn { border:1px solid #2a356b; background:#0e1a44; color:var(--text); padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:600 }
    .btn:hover { box-shadow:0 0 0 2px var(--ring) inset }
    .btn.ghost { background:#0b102000 }
    .btn.acc { background:linear-gradient(90deg,#5b8cff,#80b3ff); border-color:#6a9dff; color:#041226 }
    .btn.danger { background:#2b0f14; border-color:#6d1d26; color:#ffd5d8 }
    .chip { padding:6px 10px; border-radius:999px; background:#0f1b4a; border:1px solid #2f3b77; color:var(--muted); font-size:12px }
    .row { display:grid; grid-template-columns: 1fr; gap:16px }
    @media (min-width: 980px){ .row { grid-template-columns: 1.2fr .8fr } }
    .card { background:linear-gradient(180deg,#11193c 0,#0e1430 100%); border:1px solid #243072; border-radius:20px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25) }
    .title { font-size:28px; margin:8px 0 4px; letter-spacing:.2px }
    .subtitle { color:var(--muted); margin:0 0 12px }
    .list { display:flex; flex-direction:column; gap:8px; padding:0; margin:0 }
    .list li { list-style:none; background:#0c1436; border:1px solid #283573; padding:10px 12px; border-radius:12px }
    .hero { display:grid; grid-template-columns: 120px 1fr; gap:16px; align-items:center }
    .avatar { width:120px; height:120px; border-radius:16px; overflow:hidden; border:2px solid #2b3b7d; background:#0f1b4a; display:grid; place-items:center }
    .avatar img{ width:100%; height:100%; object-fit:cover }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color:#95b2ff }
    .grid { display:grid; gap:12px }
    .grid.two { grid-template-columns:1fr } 
    @media(min-width:900px){ .grid.two{ grid-template-columns:1fr 1fr }}
    iframe.doc { width:100%; height:72vh; border:1px solid #2a356b; border-radius:14px; background:#0a1130 }
    .video { width:100%; aspect-ratio:16/9; border:1px solid #2a356b; border-radius:14px; overflow:hidden; background:#0a1130 }
    .muted { color: var(--muted) }
    .spacer{ height:10px }

    /* Owner Panel + Backdrop (FIX: closable) */
    .owner-toggle { position: fixed; inset-inline-end: 18px; bottom: 18px; z-index: 40 }
    body.overlay-open .owner-toggle { pointer-events: none }
    .backdrop { position:fixed; inset:0; background:rgba(2,6,23,.5); display:none; z-index:49 }
    .backdrop.open{ display:block }
    .owner-panel { position: fixed; top:0; inset-inline-end:0; width:min(460px,92vw); height:100vh; background:#0b1130; border-inline-start:2px solid #2a356b; transform:translateX(100%); transition:.25s ease transform; z-index:50; display:flex; flex-direction:column }
    .owner-panel.open { transform: translateX(0) }
    .owner-head{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid #243072 }
    .owner-body{ flex:1; overflow:auto; padding:14px }
    .owner-body section{ border:1px solid #243072; border-radius:14px; padding:12px; margin-bottom:12px; background:#0f1640 }
    .owner-body h3{ margin:0 0 8px; font-size:16px }
    .fld{display:flex; flex-direction:column; gap:6px; margin-bottom:8px }
    .fld label{ font-size:12px; color:#b7c8ee }
    .fld input,.fld textarea, .fld select{ background:#0a1130; border:1px solid #283573; padding:8px 10px; border-radius:10px; color:#eaf0ff; resize:vertical }
    .owner-foot{ padding:10px 14px; border-top:1px solid #243072; display:flex; gap:8px; flex-wrap:wrap }

    /* Tabs */
    .tabs a{ text-decoration:none }
    .tabs .tab{ padding:8px 12px; border-radius:12px; border:1px solid #2a356b; color:#c8d7ff }
    .tabs .tab.active{ background:#0e1a44; box-shadow:0 0 0 2px var(--ring) inset }
    .kbd{ border:1px solid #3a4aa5; background:#0a1344; padding:0 6px; border-radius:6px; font-size:12px }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="tabs" id="tabs">
        <a href="#home" class="tab" data-tab>الرئيسية</a>
        <a href="#experience" class="tab" data-tab>الخبرات</a>
        <a href="#projects" class="tab" data-tab>المشاريع</a>
        <a href="#videos" class="tab" data-tab>الفيديو</a>
        <a href="#report" class="tab" data-tab>تقرير</a>
        <a href="#resume" class="tab" data-tab>السيرة</a>
      </div>
      <div style="display:flex; align-items:center; gap:8px">
        <button class="btn ghost" id="langBtn" title="التبديل بين العربية/English">AR</button>
        <button class="btn" id="ownerBtn" title="لوحة المالك (تعديل مباشر)">Owner</button>
      </div>
    </nav>

    <!-- HOME -->
    <main id="view-home" class="view">
      <div class="card">
        <div class="hero">
          <div class="avatar" id="avatarBox" title="profile.jpg في assets/">
            <span class="muted">No Image</span>
          </div>
          <div>
            <div class="chip" id="chipUniversity">—</div>
            <h1 class="title" id="titleName">Your Name</h1>
            <p class="subtitle" id="subtitleRole">Your role</p>
            <div class="spacer"></div>
            <div class="grid two">
              <div>
                <h3 style="margin:0 0 8px">الهدف الوظيفي / Objective</h3>
                <p id="objectiveTxt" class="muted" style="margin:0">—</p>
              </div>
              <div>
                <h3 style="margin:0 0 8px">المهارات</h3>
                <div style="display:flex; flex-wrap:wrap; gap:8px" id="skills"></div>
              </div>
            </div>
            <div class="spacer"></div>
            <div style="display:flex; gap:8px; flex-wrap:wrap" id="socials"></div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <section class="card">
          <h2 style="margin:0 0 10px">التعليم / Education</h2>
          <ul class="list" id="eduList"></ul>
        </section>
        <section class="card">
          <h2 style="margin:0 0 10px">قدرات / Abilities</h2>
          <ul class="list" id="abilitiesList"></ul>
        </section>
      </div>
    </main>

    <!-- EXPERIENCE -->
    <main id="view-experience" class="view" style="display:none">
      <div class="row">
        <section class="card">
          <h2 style="margin:0 0 10px">خبرات عملية / Experiences</h2>
          <ul class="list" id="expList"></ul>
        </section>
        <section class="card">
          <h2 style="margin:0 0 10px">Site & Industrial Exposure</h2>
          <ul class="list" id="siteList"></ul>
        </section>
      </div>
      <div class="row" style="margin-top:14px">
        <section class="card">
          <h2 style="margin:0 0 10px">Applied Mini‑Projects</h2>
          <ul class="list" id="miniList"></ul>
        </section>
      </div>
    </main>

    <!-- PROJECTS -->
    <main id="view-projects" class="view" style="display:none">
      <section class="card">
        <h2 style="margin:0 0 10px" id="projTitle">مشروع التخرج</h2>
        <ul class="list" id="projBullets"></ul>
      </section>
    </main>

    <!-- VIDEOS -->
    <main id="view-videos" class="view" style="display:none">
      <div class="grid two" id="videosGrid"></div>
    </main>

    <!-- REPORT -->
    <main id="view-report" class="view" style="display:none">
      <section class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px">
          <h2 style="margin:0">التقرير</h2>
          <a id="reportDownload" class="btn ghost" href="#" download>تنزيل</a>
        </div>
        <iframe class="doc" id="reportFrame" title="Report PDF"></iframe>
        <p class="muted" id="reportHint" style="margin-top:8px">ضع <span class="kbd">assets/report.pdf</span> أو حدّد مساره في لوحة المالك.</p>
      </section>
    </main>

    <!-- RESUME -->
    <main id="view-resume" class="view" style="display:none">
      <section class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px">
          <h2 style="margin:0">السيرة الذاتية (CV)</h2>
          <a id="cvDownload" class="btn ghost" href="#" download>تنزيل</a>
        </div>
        <iframe class="doc" id="cvFrame" title="CV PDF"></iframe>
        <p class="muted" id="cvHint" style="margin-top:8px">ضع <span class="kbd">assets/CV.pdf</span> أو حدّد مساره في لوحة المالك.</p>
      </section>
    </main>
  </div>

  <!-- Floating Owner toggle -->
  <div class="owner-toggle"><button class="btn acc" id="floatOwner">فتح لوحة المالك</button></div>
  <div class="backdrop" id="backdrop"></div>

  <!-- Owner Panel -->
  <aside class="owner-panel" id="ownerPanel" aria-hidden="true">
    <div class="owner-head">
      <strong>لوحة المالك</strong>
      <div style="display:flex; gap:6px">
        <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:#b7c8ee">
          <input type="checkbox" id="autoApply" checked /> تطبيق فوري
        </label>
        <button class="btn ghost" id="closeOwner" aria-label="إغلاق">إغلاق</button>
      </div>
    </div>
    <div class="owner-body">
      <section>
        <h3>اللغة/Language</h3>
        <div class="fld"><label>لغة التحرير</label>
          <select id="editLang">
            <option value="ar">العربية</option>
            <option value="en">English</option>
          </select>
        </div>
      </section>

      <section>
        <h3>الأساسيات</h3>
        <div class="fld"><label>الاسم / Name</label><input id="f_name" /></div>
        <div class="fld"><label>الدور (AR)</label><input id="f_role_ar" /></div>
        <div class="fld"><label>Role (EN)</label><input id="f_role_en" /></div>
        <div class="fld"><label>الجامعة (AR)</label><input id="f_univ_ar" /></div>
        <div class="fld"><label>University (EN)</label><input id="f_univ_en" /></div>
        <div class="fld"><label>الدرجة (AR)</label><input id="f_degree_ar" /></div>
        <div class="fld"><label>Degree (EN)</label><input id="f_degree_en" /></div>
        <div class="grid two">
          <div class="fld"><label>البريد</label><input id="f_email" /></div>
          <div class="fld"><label>الهاتف</label><input id="f_phone" /></div>
          <div class="fld"><label>الموقع</label><input id="f_location" /></div>
        </div>
      </section>

      <section>
        <h3>الهدف الوظيفي / Objective</h3>
        <div class="fld"><label>Objective (AR)</label><textarea id="f_obj_ar" rows="3"></textarea></div>
        <div class="fld"><label>Objective (EN)</label><textarea id="f_obj_en" rows="3"></textarea></div>
      </section>

      <section>
        <h3>القوائم (اكتب كل عنصر في سطر)</h3>
        <div class="fld"><label>خبرات (AR)</label><textarea id="f_exp_ar" rows="4"></textarea></div>
        <div class="fld"><label>Experiences (EN)</label><textarea id="f_exp_en" rows="4"></textarea></div>
        <div class="fld"><label>Site/Industrial Exposure (AR)</label><textarea id="f_site_ar" rows="4"></textarea></div>
        <div class="fld"><label>Site/Industrial Exposure (EN)</label><textarea id="f_site_en" rows="4"></textarea></div>
        <div class="fld"><label>Applied Mini‑Projects (AR)</label><textarea id="f_mini_ar" rows="4"></textarea></div>
        <div class="fld"><label>Applied Mini‑Projects (EN)</label><textarea id="f_mini_en" rows="4"></textarea></div>
        <div class="fld"><label>مهارات (AR)</label><textarea id="f_skills_ar" rows="3"></textarea></div>
        <div class="fld"><label>Skills (EN)</label><textarea id="f_skills_en" rows="3"></textarea></div>
        <div class="fld"><label>قدرات/Abilities (AR)</label><textarea id="f_abilities_ar" rows="4"></textarea></div>
        <div class="fld"><label>Abilities (EN)</label><textarea id="f_abilities_en" rows="4"></textarea></div>
        <div class="fld"><label>تعليم (AR)</label><textarea id="f_edu_ar" rows="3"></textarea></div>
        <div class="fld"><label>Education (EN)</label><textarea id="f_edu_en" rows="3"></textarea></div>
      </section>

      <section>
        <h3>المشاريع</h3>
        <div class="fld"><label>عنوان المشروع (AR)</label><input id="f_proj_title_ar" placeholder="عنكبوت روبوتي سداسي الأرجل"/></div>
        <div class="fld"><label>Project Title (EN)</label><input id="f_proj_title_en" placeholder="Multi‑purpose Hexapod Robot"/></div>
        <div class="fld"><label>نِقاط المشروع (AR) — سطر لكل نقطة</label><textarea id="f_proj_bul_ar" rows="5"></textarea></div>
        <div class="fld"><label>Project bullets (EN)</label><textarea id="f_proj_bul_en" rows="5"></textarea></div>
      </section>

      <section>
        <h3>الوسائط</h3>
        <div class="fld"><label>صورة الملف (profileImage)</label><input id="f_profile" placeholder="assets/profile.jpg" /></div>
        <div class="fld"><label>ملف التقرير (reportFile)</label><input id="f_report" placeholder="assets/report.pdf" /></div>
        <div class="fld"><label>ملف السيرة (cvFile)</label><input id="f_cv" placeholder="assets/CV.pdf" /></div>
        <div class="fld"><label>الفيديوهات (سطر لكل رابط YouTube أو mp4)</label><textarea id="f_videos" rows="4"></textarea></div>
      </section>

      <section>
        <h3>روابط التواصل</h3>
        <div class="fld"><label>اسم | رابط — أو فقط الرابط</label><textarea id="f_social" rows="4" placeholder="GitHub | https://github.com/username\nhttps://wa.me/9677XXXXXXX"></textarea></div>
      </section>

      <section>
        <h3>الدخول وإدارة الإعدادات</h3>
        <div class="grid two">
          <button class="btn" id="btnExport">تصدير config.json</button>
          <label class="btn ghost" for="fileImport" style="display:grid; place-items:center; cursor:pointer">استيراد config.json</label>
          <input id="fileImport" type="file" accept="application/json" style="display:none" />
          <button class="btn" id="btnSaveLocal">حفظ محلي</button>
          <button class="btn danger" id="btnClearLocal">حذف التخزين المحلي</button>
        </div>
        <p class="muted" style="margin-top:6px">تذكير: لا يوجد خادم. للتطبيق على الموقع، صدّر الملف ثم ارفعه إلى <span class="kbd">assets/config.json</span> على Cloudflare Pages.</p>
      </section>

      <section>
        <h3>بيانات دخول المالك (محلي فقط)</h3>
        <div class="fld"><label>كلمة المرور</label><input id="f_owner_pass" placeholder="admin" /></div>
        <div class="fld"><label>رمز الدخول</label><input id="f_owner_code" placeholder="11223341" /></div>
        <button class="btn" id="btnSaveCreds">حفظ بيانات الدخول</button>
      </section>
    </div>
    <div class="owner-foot">
      <button class="btn acc" id="btnApply">تطبيق على الصفحة</button>
      <button class="btn ghost" id="btnReload">إعادة تحميل من الملفات</button>
    </div>
  </aside>

  <!-- Login Modal -->
  <div class="modal" id="loginModal" aria-hidden="true" style="position:fixed; inset:0; display:none; place-items:center; background:rgba(2,6,23,.6); backdrop-filter: blur(4px); z-index:60">
    <div class="box" style="width:min(420px,92vw); background:#0c1436; border:1px solid #2a356b; border-radius:16px; padding:16px">
      <h3 style="margin:0 0 8px">تسجيل دخول المالك</h3>
      <p class="muted" style="margin:0 0 10px">هذه الحماية محلية للتنظيم فقط.
        لا تستخدمها كحماية حقيقية على الإنترنت.</p>
      <div class="fld"><label>كلمة المرور</label><input id="loginPass" type="password" placeholder="admin" /></div>
      <div class="fld"><label>رمز الدخول</label><input id="loginCode" type="password" placeholder="11223341" /></div>
      <div style="display:flex; gap:8px; justify-content:flex-end">
        <button class="btn ghost" id="loginCancel">إلغاء</button>
        <button class="btn acc" id="loginOk">دخول</button>
      </div>
    </div>
  </div>

  <script>
  // ====== Shortcuts ======
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

  // ====== Default Config (enriched based on CV) ======
  const defaultConfig = {
    name: "Sulaiman Mohammed Mohammed Al‑Shabebi",
    role_ar: "مهندس ميكاترونكس — مستوى مبتدئ يستهدف الأتمتة/PLC",
    role_en: "Entry‑level Mechatronics Engineer targeting Automation/PLC",
    university_ar: "جامعة الأكاديميين العرب للعلوم والتكنولوجيا",
    university_en: "Arab Academicians University of Science and Technology",
    degree_ar: "بكالوريوس هندسة ميكاترونكس — 2025",
    degree_en: "B.Eng. Mechatronics Engineering — 2025",
    email: "a.a.alshapipi@gmail.com",
    phone: "778.857.221",
    location: "Sana'a, Yemen",

    objective_ar: "مهندس ميكاترونكس مبتدئ يستهدف مجالات الأتمتة وPLC؛ متمكن من CAD (SolidWorks) وأنظمة التحكم وتحسين العمليات؛ مرتاح للاختبارات الميدانية والتكرارات السريعة.",
    objective_en: "Entry‑level Mechatronics engineer targeting automation/PLC roles. Applies skills in CAD (SolidWorks), control systems, and process optimization; comfortable with on‑site testing and rapid iterations.",

    exp_ar: [
      "مشروع تخرج — روبوت سداسي الأرجل: تصميم ميكانيكي في SolidWorks؛ تجميعات؛ فحوصات الحركة والتداخل",
      "اختيار/تحجيم مشغلات وحساسات؛ تكامل المتحكم (Raspberry Pi)",
      "نمذجة أولية واختبارات ميدانية على تضاريس متنوعة وتحسين الثبات والجر",
      "توثيق وعروض تقنية"
    ],
    exp_en: [
      "Capstone — Hexapod Robot: SolidWorks mechanical design; assemblies; motion/interference checks",
      "Actuator & sensor sizing; Raspberry Pi controller integration",
      "Prototype build and terrain testing; stability & traction improvements",
      "Documentation and technical presentations"
    ],

    site_ar: [
      "محطة توليد حزيز: أساسيات التوليد/التوزيع، أنظمة الحماية، ممارسات السلامة",
      "مصنع إسمنت عمران: خطوط إنتاج ثقيلة، المحركات وأنظمة التحكم، مناولة المواد"
    ],
    site_en: [
      "Hizyaz Power Generation Station: generation/distribution fundamentals, protection systems, site safety",
      "Amran Cement Plant: heavy production lines, motors & control systems, material handling"
    ],

    mini_ar: [
      "Arduino: قراءة حساسات، تحكم محركات، تواصل تسلسلي، نمذجة سريعة",
      "PLC: سلالم تحكم أساسية start/stop، تعيين I/O، إنترلوكات بسيطة",
      "LabVIEW: اقتناء بيانات ولوحات مراقبة",
      "MATLAB: محاكاة تحكم أولية وتحليل بيانات"
    ],
    mini_en: [
      "Arduino: sensor reading, motor control, serial communication; rapid prototyping",
      "PLC: basic Ladder logic for start/stop circuits; I/O mapping; simple interlocks",
      "LabVIEW: data acquisition and monitoring dashboards",
      "MATLAB: preliminary control simulations and data analysis"
    ],

    skills_ar: [
      "SolidWorks","Raspberry Pi","MATLAB","Arduino","PLC","LabVIEW","Microsoft Office"
    ],
    skills_en: [
      "SolidWorks","Raspberry Pi","MATLAB","Arduino","PLC","LabVIEW","Microsoft Office"
    ],

    abilities_ar: [
      "تصميم وتكامل أنظمة: ترجمة المتطلبات إلى تصميمات ميكانيكية/كهربائية لروبوت سداسي الأرجل",
      "الاختبارات الميدانية: بناء نماذج أولية وتجارب تضاريس وتحسينات متتابعة",
      "التعرض الصناعي: زيارات لمحطة حزيز ومصنع إسمنت عمران",
      "التوثيق والعروض: تقارير واضحة وعروض حديثة",
      "العمل الجماعي ومشاركة المعرفة",
      "إدارة الوقت والالتزام بالمواعيد",
      "التواصل: العربية (لغة أم) | الإنجليزية (أساسيات/دبلوم)",
      "السلامة المهنية: تطبيق قواعد وإجراءات السلامة"
    ],
    abilities_en: [
      "System Design & Integration for a hexapod robot",
      "Prototyping & field testing with iterative improvements",
      "Industrial exposure at Hizyaz Power Station & Amran Cement Plant",
      "Documentation & modern slide decks",
      "Teamwork & mentoring",
      "Time management",
      "Communication: Arabic (native), English (diploma)",
      "Safety awareness in industrial environments"
    ],

    edu_ar: [
      "بكالوريوس هندسة ميكاترونكس — جامعة الأكاديميين العرب للعلوم والتكنولوجيا — 2025",
      "دبلوم لغة إنجليزية — معهد LPM — 2019",
      "الثانوية العامة (القسم العلمي) — المعدل 86.25% — 2020"
    ],
    edu_en: [
      "B.Eng. Mechatronics Engineering — Arab Academicians University of Science and Technology — 2025",
      "English Diploma — LPM Institute — 2019",
      "High school (Science stream) — GPA 86.25% — 2020"
    ],
      "System Design & Integration for a hexapod robot",
      "Prototyping & field testing with iterative improvements",
      "Industrial exposure at Hizyaz Power Station & Amran Cement Plant",
      "Documentation & modern slide decks",
      "Teamwork & mentoring",
      "Time management",
      "Communication: Arabic (native), English (diploma)",
      "Safety awareness in industrial environments"
    ],

    proj_title_ar: "عنكبوت روبوتي سداسي الأرجل (Hexapod)",
    proj_title_en: "Capstone — Multi‑purpose Hexapod Robot",
    proj_bul_ar: [
      "تصميم ميكانيكي في SolidWorks مع تجميعات وفحوصات حركة/تداخل",
      "تحجيم مشغلات وحساسات وتكامل Raspberry Pi للتحكم",
      "اختبارات تضاريس وتحسينات للثبات والجر",
      "توثيق وعرض النتائج"
    ],
    proj_bul_en: [
      "SolidWorks mechanical design with assemblies and motion checks",
      "Actuator/sensor sizing and Raspberry Pi control integration",
      "Terrain tests with stability/traction improvements",
      "Documentation and presentations"
    ],

    profileImage: "assets/profile.jpg",
    reportFile: "assets/report.pdf",
    cvFile: "assets/CV.pdf",
    videos: ["https://youtu.be/dQw4w9WgXcQ"],
    social: [
      { name: "GitHub", url: "https://github.com/username" },
      { name: "LinkedIn", url: "https://www.linkedin.com/in/username" },
      { name: "WhatsApp", url: "https://wa.me/9677XXXXXXX" }
    ]
  };

  let ownerLock=false;
  const state = {
    config: structuredClone(defaultConfig),
    lang: localStorage.getItem('lang') || 'ar',
    autoApply: true,
  };

  // ====== Boot ======
  window.addEventListener('hashchange', syncRoute);
  document.addEventListener('DOMContentLoaded', init);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeOwner(); }); // ESC closes panel

  async function init(){
    // UI hooks
    $('#langBtn').addEventListener('click', toggleLang);

    // Owner toggles now act as toggle (open/close)
    const toggleOwner = (ev)=>{ if(ev) ev.stopPropagation(); if(ownerLock) return;
      const open = $('#ownerPanel').classList.contains('open');
      if(open) closeOwner(); else openOwnerFlow();
    };
    $('#ownerBtn').addEventListener('click', toggleOwner);
    $('#floatOwner').addEventListener('click', toggleOwner);

    $('#closeOwner').addEventListener('click', (e)=> closeOwner(e));
    $('#backdrop').addEventListener('click', (e)=> closeOwner(e)); // click outside closes
    document.addEventListener('mousedown', (e)=>{ // click outside panel closes
      const p=$('#ownerPanel'); if(!p.classList.contains('open')) return;
      if(!p.contains(e.target) && e.target !== $('#ownerBtn') && e.target !== $('#floatOwner')) closeOwner();
    });

    $('#btnApply').addEventListener('click', () => applyToDOM());
    $('#btnReload').addEventListener('click', () => loadConfig(true));
    $('#btnExport').addEventListener('click', exportConfig);
    $('#fileImport').addEventListener('change', onImport);
    $('#btnSaveLocal').addEventListener('click', saveLocal);
    $('#btnClearLocal').addEventListener('click', clearLocal);
    $('#btnSaveCreds').addEventListener('click', saveCreds);
    $('#autoApply').addEventListener('change', (e)=> state.autoApply = e.target.checked);
    $('#editLang').addEventListener('change', fillForm);

    // Login modal buttons
    $('#loginOk').addEventListener('click', tryLogin);
    $('#loginCancel').addEventListener('click', (e)=>{ e.stopPropagation(); ownerLock=true; setTimeout(()=>ownerLock=false,400); modal(false); });
    $('#loginModal').addEventListener('click', (e)=>{ if(e.target && e.target.id==='loginModal'){ e.stopPropagation(); ownerLock=true; setTimeout(()=>ownerLock=false,400); modal(false); } });

    // Load creds defaults if not set
    if(!localStorage.getItem('ownerCreds')){
      localStorage.setItem('ownerCreds', JSON.stringify({pass:'admin', code:'11223341'}));
    }

    // Load configuration
    await loadConfig(false);
    applyToDOM();
    fillForm();

    // Set initial language
    setLang(state.lang);
    syncRoute();

    // Form inputs live-binding
    bindFormInputs();
  }

  // ====== Config Loading / Saving ======
  async function loadConfig(forceNetwork){
    const localJson = localStorage.getItem('configJSON');
    if(!forceNetwork && localJson){
      try{ state.config = JSON.parse(localJson) }catch{ state.config = structuredClone(defaultConfig) }
      return;
    }
    try{
      const res = await fetch('assets/config.json?ts='+Date.now());
      if(res.ok){ state.config = await res.json(); localStorage.setItem('configJSON', JSON.stringify(state.config)); }
      else if(localJson){ state.config = JSON.parse(localJson) }
      else { state.config = structuredClone(defaultConfig) }
    }catch(err){
      if(localJson){ try{ state.config = JSON.parse(localJson) }catch{ state.config = structuredClone(defaultConfig) } }
      else { state.config = structuredClone(defaultConfig) }
    }
  }

  function saveLocal(){ localStorage.setItem('configJSON', JSON.stringify(state.config)); toast('تم الحفظ محليًا'); }
  function clearLocal(){ localStorage.removeItem('configJSON'); toast('تم حذف التخزين المحلي'); }

  function exportConfig(){
    const blob = new Blob([JSON.stringify(state.config, null, 2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'config.json'; a.click(); setTimeout(()=> URL.revokeObjectURL(a.href), 5000);
  }

  async function onImport(ev){
    const f = ev.target.files[0]; if(!f) return; const txt = await f.text();
    try{ const json = JSON.parse(txt); state.config = json; saveLocal(); fillForm(); applyToDOM(); toast('تم الاستيراد والتطبيق'); }
    catch{ toast('ملف غير صالح', true) }
    ev.target.value = '';
  }

  // ====== Rendering ======
  function applyToDOM(){
    const c = state.config; const lang = state.lang;
    document.documentElement.dir = (lang==='ar'? 'rtl':'ltr');
    document.documentElement.lang = lang;
    $('#langBtn').textContent = lang.toUpperCase();

    // Title & role
    $('#titleName').textContent = c.name || 'Your Name';
    $('#subtitleRole').textContent = lang==='ar' ? (c.role_ar||'—') : (c.role_en||'—');
    $('#chipUniversity').textContent = lang==='ar' ? (c.university_ar||'—') : (c.university_en||'—');

    // Objective
    $('#objectiveTxt').textContent = lang==='ar' ? (c.objective_ar||'—') : (c.objective_en||'—');

    // Avatar
    const avatar = $('#avatarBox'); avatar.innerHTML='';
    if(c.profileImage){ const img = new Image(); img.src = c.profileImage; img.alt = 'Profile'; img.onerror = ()=> avatar.innerHTML = '<span class="muted">No Image</span>'; avatar.appendChild(img); }
    else { avatar.innerHTML = '<span class="muted">No Image</span>'; }

    // Skills chips
    const skillsHost = $('#skills'); skillsHost.innerHTML = '';
    const skills = (lang==='ar'? c.skills_ar : c.skills_en) || [];
    skills.forEach(s=>{ const sp=document.createElement('span'); sp.className='chip'; sp.textContent=s; skillsHost.appendChild(sp) });

    // Socials
    const socials = $('#socials'); socials.innerHTML='';
    ;(c.social||[]).forEach(o=>{ if(!o || !o.url) return; const a=document.createElement('a'); a.href=o.url; a.target='_blank'; a.rel='noopener'; a.className='btn ghost'; a.textContent=o.name||hostFromUrl(o.url); socials.appendChild(a); });

    // Experiences & Education & Abilities
    fillList('#expList', (lang==='ar'? c.exp_ar : c.exp_en) || []);
    fillList('#eduList', (lang==='ar'? c.edu_ar : c.edu_en) || []);
    fillList('#abilitiesList', (lang==='ar'? c.abilities_ar : c.abilities_en) || []);

    // Site exposure & mini projects
    fillList('#siteList', (lang==='ar'? c.site_ar : c.site_en) || []);
    fillList('#miniList', (lang==='ar'? c.mini_ar : c.mini_en) || []);

    // Project
    $('#projTitle').textContent = lang==='ar' ? (c.proj_title_ar||'مشروع') : (c.proj_title_en||'Project');
    fillList('#projBullets', (lang==='ar'? c.proj_bul_ar : c.proj_bul_en) || []);

    // Videos
    const vg = $('#videosGrid'); vg.innerHTML=''; (c.videos||[]).forEach((v)=> vg.appendChild(makeVideo(v)) );

    // Report
    setDoc('#reportFrame', '#reportDownload', '#reportHint', c.reportFile);

    // Resume
    setDoc('#cvFrame', '#cvDownload', '#cvHint', c.cvFile);

    // Tabs state
    updateTabs();
  }

  function setDoc(frameSel, btnSel, hintSel, path){
    const fr = $(frameSel), btn=$(btnSel), hint=$(hintSel);
    if(path){ fr.src = path; btn.href = path; hint.style.display='none'; }
    else { fr.removeAttribute('src'); btn.removeAttribute('href'); hint.style.display='block'; }
  }

  function fillList(sel, items){ const host = $(sel); host.innerHTML=''; items.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; host.appendChild(li) }) }

  function makeVideo(url){ const wrap = document.createElement('div'); wrap.className='card'; const box = document.createElement('div'); box.className='video';
    if(/youtu\.be|youtube\.com/.test(url)){ const id = toYouTubeId(url); box.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}" title="YouTube" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`; }
    else if(/\.mp4($|\?)/.test(url)){ box.innerHTML = `<video width=100% height=100% controls><source src="${url}" type="video/mp4">Your browser does not support video.</video>`; }
    else{ box.innerHTML = `<div style="display:grid; place-items:center; height:100%; color:#9ab">رابط غير معروف</div>` }
    wrap.appendChild(box); return wrap; }

  function toYouTubeId(u){ try{ const url = new URL(u); if(url.hostname==='youtu.be') return url.pathname.slice(1); if(url.searchParams.get('v')) return url.searchParams.get('v'); const m = url.pathname.match(/\/embed\/([\w-]+)/); if(m) return m[1]; return ''; }catch{ return '' } }
  function hostFromUrl(u){ try{ return new URL(u).hostname.replace('www.',''); }catch{ return 'Link' } }

  // ====== Language & Routing ======
  function setLang(l){ state.lang=l; localStorage.setItem('lang', l); applyToDOM(); $('#langBtn').textContent=l.toUpperCase(); }
  function toggleLang(){ setLang(state.lang==='ar'? 'en':'ar') }

  function syncRoute(){ const hash = (location.hash || '#home'); $$('.view').forEach(v=> v.style.display='none'); const map = { '#home':'view-home', '#videos':'view-videos', '#report':'view-report', '#resume':'view-resume', '#experience':'view-experience', '#projects':'view-projects' }; const id = map[hash] || 'view-home'; const el = document.getElementById(id); if(el) el.style.display='block'; updateTabs(); }
  function updateTabs(){ const hash = (location.hash || '#home'); $$('#tabs [data-tab]').forEach(a=> a.classList.toggle('active', a.getAttribute('href')===hash)); }

  // ====== Owner Panel & Login ======
  function openOwnerFlow(){ modal(true) }
  function closeOwner(ev){ if(ev) ev.stopPropagation(); ownerLock=true; setTimeout(()=>ownerLock=false,400); document.body.classList.remove('overlay-open'); $('#ownerPanel').classList.remove('open'); $('#ownerPanel').setAttribute('aria-hidden','true'); $('#backdrop').classList.remove('open'); modal(false); }

  function modal(show){
    const m=$('#loginModal');
    if(show){
      document.body.classList.add('overlay-open');
      m.style.display='grid';
      m.setAttribute('aria-hidden','false');
      $('#loginPass').focus();
    } else {
      m.style.display='none';
      m.setAttribute('aria-hidden','true');
      // remove overlay-open only if owner panel not open
      if(!$('#ownerPanel').classList.contains('open')) document.body.classList.remove('overlay-open');
    }
  }

  function tryLogin(){ const pass = $('#loginPass').value.trim(); const code = $('#loginCode').value.trim(); const creds = JSON.parse(localStorage.getItem('ownerCreds')||'{"pass":"admin","code":"11223341"}'); if(pass===creds.pass && code===creds.code){ modal(false); openOwner(); } else { toast('بيانات الدخول غير صحيحة', true) } }

  function openOwner(){ const p=$('#ownerPanel'); document.body.classList.add('overlay-open'); p.classList.add('open'); p.setAttribute('aria-hidden','false'); $('#backdrop').classList.add('open'); }
  function saveCreds(){ const pass = $('#f_owner_pass').value.trim() || 'admin'; const code = $('#f_owner_code').value.trim() || '11223341'; localStorage.setItem('ownerCreds', JSON.stringify({pass, code})); toast('تم حفظ بيانات الدخول'); }

  // ====== Form Binding ======
  function bindFormInputs(){
    const bind = (id, set) => { const el = document.getElementById(id); el.addEventListener('input', ()=>{ set(el.value); changed(); }); };

    bind('f_name',   (v)=> state.config.name=v);
    bind('f_role_ar', (v)=> state.config.role_ar=v);
    bind('f_role_en', (v)=> state.config.role_en=v);
    bind('f_univ_ar', (v)=> state.config.university_ar=v);
    bind('f_univ_en', (v)=> state.config.university_en=v);
    bind('f_degree_ar', (v)=> state.config.degree_ar=v);
    bind('f_degree_en', (v)=> state.config.degree_en=v);
    bind('f_email', (v)=> state.config.email=v);
    bind('f_phone', (v)=> state.config.phone=v);
    bind('f_location', (v)=> state.config.location=v);

    bind('f_obj_ar', (v)=> state.config.objective_ar=v);
    bind('f_obj_en', (v)=> state.config.objective_en=v);

    $('#f_exp_ar').addEventListener('input', ()=>{ state.config.exp_ar = areaToList('#f_exp_ar'); changed() });
    $('#f_exp_en').addEventListener('input', ()=>{ state.config.exp_en = areaToList('#f_exp_en'); changed() });
    $('#f_site_ar').addEventListener('input', ()=>{ state.config.site_ar = areaToList('#f_site_ar'); changed() });
    $('#f_site_en').addEventListener('input', ()=>{ state.config.site_en = areaToList('#f_site_en'); changed() });
    $('#f_mini_ar').addEventListener('input', ()=>{ state.config.mini_ar = areaToList('#f_mini_ar'); changed() });
    $('#f_mini_en').addEventListener('input', ()=>{ state.config.mini_en = areaToList('#f_mini_en'); changed() });
    $('#f_skills_ar').addEventListener('input', ()=>{ state.config.skills_ar = areaToList('#f_skills_ar'); changed() });
    $('#f_skills_en').addEventListener('input', ()=>{ state.config.skills_en = areaToList('#f_skills_en'); changed() });
    $('#f_abilities_ar').addEventListener('input', ()=>{ state.config.abilities_ar = areaToList('#f_abilities_ar'); changed() });
    $('#f_abilities_en').addEventListener('input', ()=>{ state.config.abilities_en = areaToList('#f_abilities_en'); changed() });

    // Education fields (bind + live update)
    $('#f_edu_ar').addEventListener('input', ()=>{ state.config.edu_ar = areaToList('#f_edu_ar'); changed() });
    $('#f_edu_en').addEventListener('input', ()=>{ state.config.edu_en = areaToList('#f_edu_en'); changed() });

    bind('f_proj_title_ar', (v)=> state.config.proj_title_ar=v);
    bind('f_proj_title_en', (v)=> state.config.proj_title_en=v);
    $('#f_proj_bul_ar').addEventListener('input', ()=>{ state.config.proj_bul_ar = areaToList('#f_proj_bul_ar'); changed() });
    $('#f_proj_bul_en').addEventListener('input', ()=>{ state.config.proj_bul_en = areaToList('#f_proj_bul_en'); changed() });

    bind('f_profile', (v)=> state.config.profileImage = v.trim());
    bind('f_report', (v)=> state.config.reportFile = v.trim());
    bind('f_cv', (v)=> state.config.cvFile = v.trim());
    $('#f_videos').addEventListener('input', ()=>{ state.config.videos = areaToList('#f_videos'); changed() });
    $('#f_social').addEventListener('input', ()=>{ state.config.social = parseSocial($('#f_social').value); changed() });
  }

  function changed(){ saveLocal(); if(state.autoApply) applyToDOM(); }

  function fillForm(){
    const c = state.config;
    $('#f_name').value = c.name||''; $('#f_role_ar').value = c.role_ar||''; $('#f_role_en').value = c.role_en||'';
    $('#f_univ_ar').value = c.university_ar||''; $('#f_univ_en').value = c.university_en||'';
    $('#f_degree_ar').value = c.degree_ar||''; $('#f_degree_en').value = c.degree_en||'';
    $('#f_email').value = c.email||''; $('#f_phone').value = c.phone||''; $('#f_location').value = c.location||'';

    $('#f_obj_ar').value = c.objective_ar||''; $('#f_obj_en').value = c.objective_en||'';

    $('#f_exp_ar').value = (c.exp_ar||[]).join('\n'); $('#f_exp_en').value = (c.exp_en||[]).join('\n');
    $('#f_site_ar').value = (c.site_ar||[]).join('\n'); $('#f_site_en').value = (c.site_en||[]).join('\n');
    $('#f_mini_ar').value = (c.mini_ar||[]).join('\n'); $('#f_mini_en').value = (c.mini_en||[]).join('\n');
    $('#f_skills_ar').value = (c.skills_ar||[]).join('\n'); $('#f_skills_en').value = (c.skills_en||[]).join('\n');
    $('#f_abilities_ar').value = (c.abilities_ar||[]).join('\n'); $('#f_abilities_en').value = (c.abilities_en||[]).join('\n');

    $('#f_proj_title_ar').value = c.proj_title_ar||''; $('#f_proj_title_en').value = c.proj_title_en||'';
    $('#f_proj_bul_ar').value = (c.proj_bul_ar||[]).join('\n'); $('#f_proj_bul_en').value = (c.proj_bul_en||[]).join('\n');

    $('#f_profile').value = c.profileImage||''; $('#f_report').value = c.reportFile||''; $('#f_cv').value = c.cvFile||'';
    $('#f_videos').value = (c.videos||[]).join('\n');
    $('#f_social').value = (c.social||[]).map(o=> o && o.name ? `${o.name} | ${o.url}` : (o? o.url: '') ).join('\n');
  }

  function areaToList(sel){ return $(sel).value.split(/\r?\n/).map(s=> s.trim()).filter(Boolean) }
  function parseSocial(text){ return text.split(/\r?\n/).map(line=>{ const s=line.trim(); if(!s) return null; if(s.includes('|')){ const [name,url] = s.split('|').map(t=>t.trim()); return {name, url}; } return { name: hostFromUrl(s), url: s }; }).filter(Boolean); }

  // ====== Toast ======
  function toast(msg, err=false){ const t=document.createElement('div'); t.textContent = msg; t.style.cssText = `position:fixed;inset-inline:0;top:10px;margin:auto;max-width:520px;background:${err?'#3b0d14':'#0a1d48'};border:1px solid ${err?'#6d1d26':'#2a356b'};padding:10px 12px;border-radius:12px;text-align:center;z-index:99; color:#eaf0ff`; document.body.appendChild(t); setTimeout(()=> t.remove(), 2200); }
  </script>
</body>
</html>
